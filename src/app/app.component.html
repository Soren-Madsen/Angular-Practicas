<div class="container">
  <header class="mb-4">
    <h1>{{ title }}</h1>
  </header>

  <!-- Mensaje de error -->
  <div class="alert alert-danger" *ngIf="error">
    {{ error }}
    <button type="button" class="btn-close" (click)="error = null"></button>
  </div>

  <!-- Loading spinner -->
  <div class="text-center my-4" *ngIf="loading">
    <div class="spinner">Cargando...</div>
  </div>

  <!-- Bot칩n para mostrar/ocultar formulario -->
  <button class="btn btn-primary mb-3" (click)="toggleForm()" [disabled]="loading">
    {{ showForm ? 'Cancelar' : 'Nueva Persona' }}
  </button>

  <!-- Formulario de creaci칩n/edici칩n -->
  <div class="card mb-4" *ngIf="showForm">
    <div class="card-header">
      <h3>{{ editingPerson ? 'Editar Persona' : 'Nueva Persona' }}</h3>
    </div>
    <div class="card-body">
      <form [formGroup]="personForm" (ngSubmit)="onSubmit()">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="name" class="form-label">Nombre *</label>
            <input 
              type="text" 
              class="form-control" 
              id="name" 
              formControlName="name"
              [class.is-invalid]="personForm.get('name')?.invalid && personForm.get('name')?.touched">
            <div class="invalid-feedback" *ngIf="personForm.get('name')?.invalid && personForm.get('name')?.touched">
              <span *ngIf="personForm.get('name')?.errors?.['required']">El nombre es requerido</span>
              <span *ngIf="personForm.get('name')?.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</span>
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="work" class="form-label">Trabajo *</label>
            <select 
              class="form-control" 
              id="work" 
              formControlName="work"
              [class.is-invalid]="personForm.get('work')?.invalid && personForm.get('work')?.touched">
              <option value="">Selecciona un trabajo</option>
              <option *ngFor="let option of workOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
            <div class="invalid-feedback" *ngIf="personForm.get('work')?.invalid && personForm.get('work')?.touched">
              El trabajo es requerido
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="birthDate" class="form-label">Fecha de Nacimiento *</label>
            <input 
              type="date" 
              class="form-control" 
              id="birthDate" 
              formControlName="birthDate"
              [class.is-invalid]="personForm.get('birthDate')?.invalid && personForm.get('birthDate')?.touched">
            <div class="invalid-feedback" *ngIf="personForm.get('birthDate')?.invalid && personForm.get('birthDate')?.touched">
              La fecha de nacimiento es requerida
            </div>
          </div>

          <div class="col-md-6 mb-3 d-flex align-items-center">
            <div class="form-check">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="acceptsCommercial" 
                formControlName="acceptsCommercial">
              <label class="form-check-label" for="acceptsCommercial">
                Acepta comunicaciones comerciales
              </label>
            </div>
          </div>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-success" [disabled]="personForm.invalid || loading">
            {{ editingPerson ? 'Actualizar' : 'Crear' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Listado de personas -->
  <div class="card">
    <div class="card-header">
      <h3>Listado de Personas ({{ people.length }})</h3>
    </div>
    <div class="card-body">
      <div *ngIf="people.length === 0 && !loading" class="alert alert-info">
        No hay personas para mostrar
      </div>

      <div class="table-responsive" *ngIf="people.length > 0">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Trabajo</th>
              <th>Fecha Nacimiento</th>
              <th>Edad</th>
              <th>Comunicaciones</th>
              <th>Cumplea침os</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let person of people" [class.birthday]="person.isBirthday">
              <td>{{ person.id }}</td>
              <td>
                {{ person.name }}
                <span *ngIf="person.isBirthday" class="birthday-icon">游꾹</span>
              </td>
              <td>{{ getWorkLabel(person.work) }}</td>
              <td>{{ person.birthDate | date:'dd/MM/yyyy' }}</td>
              <td>{{ person.age }} a침os</td>
              <td>
                <span class="badge" [class]="person.acceptsCommercial ? 'badge-success' : 'badge-danger'">
                  {{ person.acceptsCommercial ? 'S칤' : 'No' }}
                </span>
              </td>
              <td>
                <span class="badge" [class]="person.isBirthday ? 'badge-warning' : 'badge-secondary'">
                  {{ person.isBirthday ? 'Hoy!' : 'No' }}
                </span>
              </td>
              <td>
                <div class="btn-group">
                  <button class="btn btn-sm btn-outline-primary" (click)="editPerson(person)" [disabled]="loading">
                    Editar
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="deletePerson(person.id!)" [disabled]="loading">
                    Eliminar
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>